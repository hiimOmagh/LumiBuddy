digraph ModuleMap {
    // Set the direction of the graph to left-to-right
    rankdir = LR;
    // Set the default shape of the nodes to box
    node [shape = box];

    // Define a subgraph for core components, visually grouped together
    subgraph cluster_core {
        label = "Core"; // Label for the core cluster
        color = lightblue; // Color of the cluster
        style=filled;
        node [style=filled, color=deepskyblue];
        "core-domain";
        "core-data";
        "core-infra";
    }

    // Define a subgraph for feature components, visually grouped together
    subgraph cluster_features {
        label = "Features"; // Label for the features cluster
        color = lightgreen; // Color of the cluster
        style=filled;
        node [style=filled, color=mediumseagreen];
        "feature-measurement";
        "feature-plantdb";
        "feature-diary";
        "feature-growschedule";
        "feature-ar";
    }

    // Define shared resources with elliptical shapes
    "shared-ml" [shape = ellipse, color=lightcoral, style=filled];
    "shared-ml-cloud" [shape = ellipse, color=lightcoral, style=filled];
    "shared-arcore" [shape = ellipse, color=lightcoral, style=filled];
    // Define the application node with a different style and color
    "app" [shape = box, style = filled, color = khaki];

    // Define relationships between core components
    "core-data" -> "core-domain";
    "core-infra" -> "core-domain";
    // Define relationships between the app and core components
    "app" -> "core-infra";
    "app" -> "core-data";
    "app" -> "core-domain";

    // Define relationships for feature-measurement with core and shared resources
    {rank = same; "feature-measurement" -> "core-infra"; "feature-measurement" -> "core-data"; "feature-measurement" -> "core-domain"; "feature-measurement" -> "shared-ml"; "feature-measurement" -> "shared-ml-cloud";}
    // Define relationships for feature-plantdb with core and other features
    {rank = same; "feature-plantdb" -> "core-infra"; "feature-plantdb" -> "core-data"; "feature-plantdb" -> "core-domain"; "feature-plantdb" -> "feature-diary"; "feature-plantdb" -> "shared-ml"; "feature-plantdb" -> "shared-ml-cloud";}
    // Define relationships for feature-diary with core components
    {rank = same; "feature-diary" -> "core-infra"; "feature-diary" -> "core-data"; "feature-diary" -> "core-domain";}
    // Define relationships for feature-growschedule with core components
    {rank = same; "feature-growschedule" -> "core-infra"; "feature-growschedule" -> "core-data"; "feature-growschedule" -> "core-domain";}
    // Define relationships for feature-ar with core components and shared resource
    {rank = same; "feature-ar" -> "core-infra"; "feature-ar" -> "core-data"; "feature-ar" -> "core-domain"; "feature-ar" -> "shared-arcore";}

    // Define relationships between shared ml and core-domain
    "shared-ml" -> "core-domain";
    // Define relationships between app and all features
    "app" -> "feature-measurement";
    "app" -> "feature-plantdb";
    "app" -> "feature-diary";
    "app" -> "feature-growschedule";
    "app" -> "feature-ar";
}
